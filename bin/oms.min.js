(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Leaflet maps API must be included *before* this code
Modified by Jared Hobbs
*/
(function(){var r={}.hasOwnProperty,s=[].slice;null!=this.L&&(this.OverlappingMarkerSpiderfier=function(){function q(c,a){var b,e,g,f,k=this;this.map=c;null==a&&(a={});for(b in a)r.call(a,b)&&(e=a[b],this[b]=e);this.initMarkerArrays();this.listeners={};f=["click","zoomend"];e=0;for(g=f.length;e<g;e++)b=f[e],this.map.addEventListener(b,function(){return k.unspiderfy()})}var d,n;d=q.prototype;d.VERSION="0.2.5";n=2*Math.PI;d.keepSpiderfied=!1;d.nearbyDistance=20;d.circleSpiralSwitchover=9;d.circleFootSeparation=
25;d.circleStartAngle=n/12;d.spiralFootSeparation=28;d.spiralLengthStart=11;d.spiralLengthFactor=5;d.legWeight=1.5;d.legColors={usual:"#222",highlighted:"#f00"};d.initMarkerArrays=function(){this.markers=[];return this.markerListeners=[]};d.addMarker=function(c){var a,b=this;if(null!=c._oms)return this;c._oms=!0;a=function(){return b.spiderListener(c)};c.addEventListener("click",a);this.markerListeners.push(a);this.markers.push(c);return this};d.getMarkers=function(){return this.markers.slice(0)};
d.removeMarker=function(c){var a,b;null!=c._omsData&&this.unspiderfy();a=this.arrIndexOf(this.markers,c);if(0>a)return this;b=this.markerListeners.splice(a,1)[0];c.removeEventListener("click",b);delete c._oms;this.markers.splice(a,1);return this};d.clearMarkers=function(){var c,a,b,e,g;this.unspiderfy();g=this.markers;c=b=0;for(e=g.length;b<e;c=++b)a=g[c],c=this.markerListeners[c],a.removeEventListener("click",c),delete a._oms;this.initMarkerArrays();return this};d.addListener=function(c,a){var b,
e;(null!=(e=(b=this.listeners)[c])?e:b[c]=[]).push(a);return this};d.removeListener=function(c,a){var b;b=this.arrIndexOf(this.listeners[c],a);0>b||this.listeners[c].splice(b,1);return this};d.clearListeners=function(c){this.listeners[c]=[];return this};d.trigger=function(){var c,a,b,e,g,f;a=arguments[0];c=2<=arguments.length?s.call(arguments,1):[];a=null!=(b=this.listeners[a])?b:[];f=[];e=0;for(g=a.length;e<g;e++)b=a[e],f.push(b.apply(null,c));return f};d.generatePtsCircle=function(c,a){var b,e,
g,f,k;g=this.circleFootSeparation*(2+c)/n;e=n/c;k=[];for(b=f=0;0<=c?f<c:f>c;b=0<=c?++f:--f)b=this.circleStartAngle+b*e,k.push(new L.Point(a.x+g*Math.cos(b),a.y+g*Math.sin(b)));return k};d.generatePtsSpiral=function(c,a){var b,e,g,f,k;g=this.spiralLengthStart;b=0;k=[];for(e=f=0;0<=c?f<c:f>c;e=0<=c?++f:--f)b+=this.spiralFootSeparation/g+5E-4*e,e=new L.Point(a.x+g*Math.cos(b),a.y+g*Math.sin(b)),g+=n*this.spiralLengthFactor/b,k.push(e);return k};d.spiderListener=function(c){var a,b,e,g,f,k,d,m,l;a=null!=
c._omsData;(!a||!this.keepSpiderfied)&&this.unspiderfy();if(a)return this.trigger("click",c);g=[];f=[];k=this.nearbyDistance*this.nearbyDistance;e=this.llToPt(c.getLatLng());l=this.markers;d=0;for(m=l.length;d<m;d++)a=l[d],b=this.llToPt(a.getLatLng()),this.ptDistanceSq(b,e)<k?g.push({marker:a,markerPt:b}):f.push(a);return 1===g.length?this.trigger("click",c):this.spiderfy(g,f)};d.willSpiderfy=function(c){var a,b,e,g,f,d,h,m;b=this.nearbyDistance;e=b*b;b=this.llToPt(c.getLatLng());d=this.markers;g=
0;for(f=d.length;g<f;g++)if(a=d[g],!(a===c||null==a.map||!a.getVisible()))if(a=this.llToPt(null!=(h=null!=(m=a._omsData)?m.usualPosition:void 0)?h:a.getLatLng()),this.ptDistanceSq(a,b)<e)return!0;return!1};d.markersThatWillAndWontSpiderfy=function(){var c,a,b,e,g,f,d,h,m,l,n,p;f=this.nearbyDistance;c=f*f;e=this.markers;f=[];l=0;for(b=e.length;l<b;l++)a=e[l],f.push({pt:this.llToPt(null!=(d=null!=(h=a._omsData)?h.usualPosition:void 0)?d:a.getLatLng()),willSpiderfy:!1});l=this.markers;a=d=0;for(h=l.length;d<
h;a=++d)if(b=l[a],null!=b._map&&(e=f[a],!e.willSpiderfy)){p=this.markers;b=m=0;for(n=p.length;m<n;b=++m)if(g=p[b],b!==a&&null!=g._map&&(g=f[b],(!(b<a)||g.willSpiderfy)&&this.ptDistanceSq(e.pt,g.pt)<c)){e.willSpiderfy=g.willSpiderfy=!0;break}}d=[];h=[];e=this.markers;c=l=0;for(b=e.length;l<b;c=++l)a=e[c],(f[c].willSpiderfy?d:h).push(a);return[d,h]};d.makeHighlightListeners=function(c){var a=this;return{highlight:function(){return c._omsData.leg.setStyle({color:a.legColors.highlighted})},unhighlight:function(){return c._omsData.leg.setStyle({color:a.legColors.usual})}}};
d.spiderfy=function(c,a){var b,e,g,f,d,h,m,l,n,p;this.spiderfying=!0;p=c.length;b=this.ptAverage(function(){var a,b,e;e=[];a=0;for(b=c.length;a<b;a++)m=c[a],e.push(m.markerPt);return e}());f=p>=this.circleSpiralSwitchover?this.generatePtsSpiral(p,b).reverse():this.generatePtsCircle(p,b);b=function(){var a,b,m,p=this;m=[];a=0;for(b=f.length;a<b;a++)g=f[a],e=this.ptToLl(g),n=this.minExtract(c,function(a){return p.ptDistanceSq(a.markerPt,g)}),h=n.marker,d=new L.Polyline([h.getLatLng(),e],{color:this.legColors.usual,
weight:this.legWeight,clickable:!1}),this.map.addLayer(d),h._omsData={usualPosition:h.getLatLng(),leg:d},this.legColors.highlighted!==this.legColors.usual&&(l=this.makeHighlightListeners(h),h._omsData.highlightListeners=l,h.addEventListener("mouseover",l.highlight),h.addEventListener("mouseout",l.unhighlight)),h.setLatLng(e),h.setZIndexOffset(1E6),m.push(h);return m}.call(this);delete this.spiderfying;this.spiderfied=!0;return this.trigger("spiderfy",b,a)};d.unspiderfy=function(c){var a,b,e,g,d,k,
h;null==c&&(c=null);if(null==this.spiderfied)return this;this.unspiderfying=!0;g=[];e=[];h=this.markers;d=0;for(k=h.length;d<k;d++)a=h[d],null!=a._omsData?(this.map.removeLayer(a._omsData.leg),a!==c&&a.setLatLng(a._omsData.usualPosition),a.setZIndexOffset(0),b=a._omsData.highlightListeners,null!=b&&(a.removeEventListener("mouseover",b.highlight),a.removeEventListener("mouseout",b.unhighlight)),delete a._omsData,g.push(a)):e.push(a);delete this.unspiderfying;delete this.spiderfied;this.trigger("unspiderfy",
g,e);return this};d.ptDistanceSq=function(c,a){var b,e;b=c.x-a.x;e=c.y-a.y;return b*b+e*e};d.ptAverage=function(c){var a,b,e,d,f;d=b=e=0;for(f=c.length;d<f;d++)a=c[d],b+=a.x,e+=a.y;c=c.length;return new L.Point(b/c,e/c)};d.llToPt=function(c){return this.map.latLngToLayerPoint(c)};d.ptToLl=function(c){return this.map.layerPointToLatLng(c)};d.minExtract=function(c,a){var b,e,d,f,k,h;d=k=0;for(h=c.length;k<h;d=++k)if(f=c[d],f=a(f),"undefined"===typeof b||null===b||f<e)e=f,b=d;return c.splice(b,1)[0]};
d.arrIndexOf=function(c,a){var b,d,g,f;if(null!=c.indexOf)return c.indexOf(a);b=g=0;for(f=c.length;g<f;b=++g)if(d=c[b],d===a)return b;return-1};return q}())}).call(this);}).call(this);
/* Wed Apr 10 14:18:38 MDT 2013 */
