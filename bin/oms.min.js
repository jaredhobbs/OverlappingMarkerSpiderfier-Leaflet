(function(){/*
 OverlappingMarkerSpiderfier
https://github.com/jawj/OverlappingMarkerSpiderfier-Leaflet
Copyright (c) 2011 - 2012 George MacKerron
Released under the MIT licence: http://opensource.org/licenses/mit-license
Note: The Leaflet maps API must be included *before* this code
Modified by Jared Hobbs
*/
(function(){var r={}.hasOwnProperty,s=[].slice;null!=this.L&&(this.OverlappingMarkerSpiderfier=function(){function q(c,a){var b,f,g,e,d=this;this.map=c;null==a&&(a={});for(b in a)r.call(a,b)&&(f=a[b],this[b]=f);"map"===this.legLayer&&(this.legLayer=this.map);this.initMarkerArrays();this.listeners={};e=["click","zoomend"];f=0;for(g=e.length;f<g;f++)b=e[f],this.map.addEventListener(b,function(){return d.unspiderfy()})}var d,l;d=q.prototype;d.VERSION="0.2.5";l=2*Math.PI;d.keepSpiderfied=!1;d.nearbyDistance=
20;d.circleSpiralSwitchover=9;d.circleFootSeparation=25;d.circleStartAngle=l/12;d.spiralFootSeparation=28;d.spiralLengthStart=11;d.spiralLengthFactor=5;d.legLayer="map";d.legWeight=1.5;d.legColors={usual:"#222",highlighted:"#f00"};d.initMarkerArrays=function(){this.markers=[];return this.markerListeners=[]};d.addMarker=function(c){var a,b=this;if(null!=c._oms)return this;c._oms=!0;a=function(){return b.spiderListener(c)};c.addEventListener("click",a);this.markerListeners.push(a);this.markers.push(c);
return this};d.getMarkers=function(){return this.markers.slice(0)};d.removeMarker=function(c){var a,b;null!=c._omsData&&this.unspiderfy();a=this.arrIndexOf(this.markers,c);if(0>a)return this;b=this.markerListeners.splice(a,1)[0];c.removeEventListener("click",b);delete c._oms;this.markers.splice(a,1);return this};d.clearMarkers=function(){var c,a,b,f,g;this.unspiderfy();g=this.markers;c=b=0;for(f=g.length;b<f;c=++b)a=g[c],c=this.markerListeners[c],a.removeEventListener("click",c),delete a._oms;this.initMarkerArrays();
return this};d.addListener=function(c,a){var b,f;(null!=(f=(b=this.listeners)[c])?f:b[c]=[]).push(a);return this};d.removeListener=function(c,a){var b;b=this.arrIndexOf(this.listeners[c],a);0>b||this.listeners[c].splice(b,1);return this};d.clearListeners=function(c){this.listeners[c]=[];return this};d.trigger=function(){var c,a,b,f,g,e;a=arguments[0];c=2<=arguments.length?s.call(arguments,1):[];a=null!=(b=this.listeners[a])?b:[];e=[];f=0;for(g=a.length;f<g;f++)b=a[f],e.push(b.apply(null,c));return e};
d.generatePtsCircle=function(c,a){var b,f,g,e,d;g=this.circleFootSeparation*(2+c)/l;f=l/c;d=[];for(b=e=0;0<=c?e<c:e>c;b=0<=c?++e:--e)b=this.circleStartAngle+b*f,d.push(new L.Point(a.x+g*Math.cos(b),a.y+g*Math.sin(b)));return d};d.generatePtsSpiral=function(c,a){var b,f,g,e,d;g=this.spiralLengthStart;b=0;d=[];for(f=e=0;0<=c?e<c:e>c;f=0<=c?++e:--e)b+=this.spiralFootSeparation/g+5E-4*f,f=new L.Point(a.x+g*Math.cos(b),a.y+g*Math.sin(b)),g+=l*this.spiralLengthFactor/b,d.push(f);return d};d.spiderListener=
function(c){var a,b,f,g,e,d,h,m,k;a=null!=c._omsData;(!a||!this.keepSpiderfied)&&this.unspiderfy();if(a)return this.trigger("click",c);g=[];e=[];d=this.nearbyDistance*this.nearbyDistance;f=this.llToPt(c.getLatLng());k=this.markers;h=0;for(m=k.length;h<m;h++)a=k[h],b=this.llToPt(a.getLatLng()),this.ptDistanceSq(b,f)<d?g.push({marker:a,markerPt:b}):e.push(a);return 1===g.length?this.trigger("click",c):this.spiderfy(g,e)};d.willSpiderfy=function(c){var a,b,f,g,e,d,h,m;b=this.nearbyDistance;f=b*b;b=this.llToPt(c.getLatLng());
d=this.markers;g=0;for(e=d.length;g<e;g++)if(a=d[g],!(a===c||null==a.map||!a.getVisible()))if(a=this.llToPt(null!=(h=null!=(m=a._omsData)?m.usualPosition:void 0)?h:a.getLatLng()),this.ptDistanceSq(a,b)<f)return!0;return!1};d.markersThatWillAndWontSpiderfy=function(){var c,a,b,f,g,e,d,h,m,k,l,n;e=this.nearbyDistance;c=e*e;f=this.markers;e=[];k=0;for(b=f.length;k<b;k++)a=f[k],e.push({pt:this.llToPt(null!=(d=null!=(h=a._omsData)?h.usualPosition:void 0)?d:a.getLatLng()),willSpiderfy:!1});k=this.markers;
a=d=0;for(h=k.length;d<h;a=++d)if(b=k[a],null!=b._map&&(f=e[a],!f.willSpiderfy)){n=this.markers;b=m=0;for(l=n.length;m<l;b=++m)if(g=n[b],b!==a&&null!=g._map&&(g=e[b],(!(b<a)||g.willSpiderfy)&&this.ptDistanceSq(f.pt,g.pt)<c)){f.willSpiderfy=g.willSpiderfy=!0;break}}d=[];h=[];f=this.markers;c=k=0;for(b=f.length;k<b;c=++k)a=f[c],(e[c].willSpiderfy?d:h).push(a);return[d,h]};d.makeHighlightListeners=function(c){var a=this;return{highlight:function(){return c._omsData.leg.setStyle({color:a.legColors.highlighted})},
unhighlight:function(){return c._omsData.leg.setStyle({color:a.legColors.usual})}}};d.spiderfy=function(c,a){var b,f,d,e,p,h,m,k,l,n;this.spiderfying=!0;n=c.length;b=this.ptAverage(function(){var a,b,f;f=[];a=0;for(b=c.length;a<b;a++)m=c[a],f.push(m.markerPt);return f}());e=n>=this.circleSpiralSwitchover?this.generatePtsSpiral(n,b).reverse():this.generatePtsCircle(n,b);b=function(){var a,b,m,n=this;m=[];a=0;for(b=e.length;a<b;a++)d=e[a],f=this.ptToLl(d),l=this.minExtract(c,function(a){return n.ptDistanceSq(a.markerPt,
d)}),h=l.marker,p=new L.Polyline([h.getLatLng(),f],{color:this.legColors.usual,weight:this.legWeight,clickable:!1}),this.legLayer.addLayer(p),h._omsData={usualPosition:h.getLatLng(),leg:p},this.legColors.highlighted!==this.legColors.usual&&(k=this.makeHighlightListeners(h),h._omsData.highlightListeners=k,h.addEventListener("mouseover",k.highlight),h.addEventListener("mouseout",k.unhighlight)),h.setLatLng(f),h.setZIndexOffset(1E6),m.push(h);return m}.call(this);delete this.spiderfying;this.spiderfied=
!0;return this.trigger("spiderfy",b,a)};d.unspiderfy=function(c){var a,b,f,d,e,l,h;null==c&&(c=null);if(null==this.spiderfied)return this;this.unspiderfying=!0;d=[];f=[];h=this.markers;e=0;for(l=h.length;e<l;e++)a=h[e],null!=a._omsData?(this.legLayer.removeLayer(a._omsData.leg),a!==c&&a.setLatLng(a._omsData.usualPosition),a.setZIndexOffset(0),b=a._omsData.highlightListeners,null!=b&&(a.removeEventListener("mouseover",b.highlight),a.removeEventListener("mouseout",b.unhighlight)),delete a._omsData,
d.push(a)):f.push(a);delete this.unspiderfying;delete this.spiderfied;this.trigger("unspiderfy",d,f);return this};d.ptDistanceSq=function(c,a){var b,d;b=c.x-a.x;d=c.y-a.y;return b*b+d*d};d.ptAverage=function(c){var a,b,d,g,e;g=b=d=0;for(e=c.length;g<e;g++)a=c[g],b+=a.x,d+=a.y;c=c.length;return new L.Point(b/c,d/c)};d.llToPt=function(c){return this.map.latLngToLayerPoint(c)};d.ptToLl=function(c){return this.map.layerPointToLatLng(c)};d.minExtract=function(c,a){var b,d,g,e,l,h;g=l=0;for(h=c.length;l<
h;g=++l)if(e=c[g],e=a(e),"undefined"===typeof b||null===b||e<d)d=e,b=g;return c.splice(b,1)[0]};d.arrIndexOf=function(c,a){var b,d,g,e;if(null!=c.indexOf)return c.indexOf(a);b=g=0;for(e=c.length;g<e;b=++g)if(d=c[b],d===a)return b;return-1};return q}())}).call(this);}).call(this);
/* Wed Apr 10 14:59:21 MDT 2013 */
